<!--pages/order/list/list.wxml-->
<view class="container">
  <!-- Tab导航 -->
  <view class="tab-bar">
    <view 
      class="tab-item {{currentTab === index ? 'active' : ''}}"
      wx:for="{{tabs}}"
      wx:key="status"
      data-index="{{index}}"
      bindtap="switchTab"
    >
      {{item.name}}
    </view>
  </view>

  <!-- 订单列表 -->
  <view class="order-list">
    <view 
      class="order-item"
      wx:for="{{orders}}"
      wx:key="id"
      bindtap="viewOrderDetail"
      data-id="{{item.id}}"
    >
      <!-- 订单头部 -->
      <view class="order-header">
        <view class="order-info">
          <text class="order-number">订单号：{{item.orderNumber}}</text>
          <text class="order-time">{{item.createTime}}</text>
        </view>
        <view class="order-status {{item.status}}">{{item.statusText}}</view>
      </view>

      <!-- 订单内容 -->
      <view class="order-content">
        <view class="service-info">
          <text class="service-type">{{item.serviceTypeName}}</text>
          <text class="service-desc">{{item.description}}</text>
        </view>
        <view class="order-amount" wx:if="{{item.amount}}">
          <text class="amount-label">金额：</text>
          <text class="amount-value">¥{{item.amount}}</text>
        </view>
      </view>

      <!-- 地址信息 -->
      <view class="address-info">
        <text class="address-icon">📍</text>
        <text class="address-text">{{item.address}}</text>
      </view>

      <!-- 联系信息 -->
      <view class="contact-info" wx:if="{{item.contactName}}">
        <text class="contact-name">{{item.contactName}}</text>
        <text class="contact-phone">{{item.contactPhone}}</text>
      </view>

      <!-- 电工信息（用户视角） -->
      <view class="electrician-info" wx:if="{{item.electrician && item.electrician.name}}">
        <text class="electrician-label">电工：</text>
        <text class="electrician-name">{{item.electrician.name}}</text>
        <text class="electrician-phone" bindtap="contactUser" data-phone="{{item.electrician.phone}}" catchtap="contactUser">{{item.electrician.phone}}</text>
      </view>

      <!-- 操作按钮 -->
      <view class="order-actions" catchtap="">
        <!-- 待接单状态 -->
        <block wx:if="{{item.status === 'pending'}}">
          <!-- 用户可以取消订单 -->
          <button 
            wx:if="{{item.canCancel}}"
            class="action-btn cancel-btn"
            data-id="{{item.id}}"
            catchtap="cancelOrder"
          >
            取消订单
          </button>
          <!-- 电工可以接单 -->
          <button 
            wx:if="{{item.canAccept}}"
            class="action-btn accept-btn"
            data-id="{{item.id}}"
            catchtap="acceptOrder"
          >
            接单
          </button>
        </block>

        <!-- 进行中状态 -->
        <block wx:if="{{item.status === 'in_progress'}}">
          <!-- 用户可以取消订单、联系电工 -->
          <button 
            wx:if="{{item.canCancel}}"
            class="action-btn cancel-btn"
            data-id="{{item.id}}"
            catchtap="cancelOrder"
          >
            取消订单
          </button>
          <button 
            wx:if="{{item.electrician && item.electrician.phone}}"
            class="action-btn contact-btn"
            data-phone="{{item.electrician.phone}}"
            catchtap="contactUser"
          >
            联系电工
          </button>
          <!-- 电工可以完成订单、联系用户 -->
          <button 
            wx:if="{{item.canComplete}}"
            class="action-btn complete-btn"
            data-id="{{item.id}}"
            catchtap="completeOrder"
          >
            完成订单
          </button>
          <button 
            wx:if="{{item.contactPhone}}"
            class="action-btn contact-btn"
            data-phone="{{item.contactPhone}}"
            catchtap="contactUser"
          >
            联系用户
          </button>
        </block>

        <!-- 待支付状态 -->
        <block wx:if="{{item.status === 'pending_payment'}}">
          <button 
            wx:if="{{item.canPay}}"
            class="action-btn pay-btn"
            data-id="{{item.id}}"
            catchtap="goToPay"
          >
            去支付
          </button>
        </block>

        <!-- 已完成状态 -->
        <block wx:if="{{item.status === 'completed'}}">
          <button 
            wx:if="{{item.canReview}}"
            class="action-btn review-btn"
            data-id="{{item.id}}"
            catchtap="goToReview"
          >
            评价
          </button>
        </block>
      </view>
    </view>

    <!-- 空状态 -->
    <view class="empty-state" wx:if="{{!loading && orders.length === 0}}">
      <text class="empty-icon">📋</text>
      <text class="empty-text">暂无{{tabs[currentTab].name}}订单</text>
    </view>

    <!-- 加载状态 -->
    <view class="loading-state" wx:if="{{loading}}">
      <text>加载中...</text>
    </view>

    <!-- 没有更多 -->
    <view class="no-more" wx:if="{{!hasMore && orders.length > 0}}">
      <text>没有更多订单了</text>
    </view>
  </view>
</view>