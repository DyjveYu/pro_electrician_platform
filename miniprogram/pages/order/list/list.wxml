<!--pages/order/list/list.wxml-->
<view class="container">

  <!-- è®¢å•åˆ—è¡¨ -->
  <view class="order-list">
    <view 
      class="order-item"
      wx:for="{{orders}}"
      wx:key="id"
      bindtap="viewOrderDetail"
      data-id="{{item.id}}"
    >
      <!-- è®¢å•å¤´éƒ¨ -->
      <view class="order-header">
        <view class="order-status-title">{{item.statusText}}</view>
        <view class="detail-link">è¯¦æƒ… â€º</view>
      </view>

      <!-- è®¢å•ä¿¡æ¯ -->
      <view class="order-info-list">
        <view class="info-item">
          <text class="info-label">è®¢å•ç¼–å·:</text>
          <text class="info-value">{{item.orderNumber || item.order_no}}</text>
        </view>
        <view class="info-item">
          <text class="info-label">æœåŠ¡ç±»å‹:</text>
          <text class="info-value">{{item.title || item.serviceTypeName || item.serviceType.name}}</text>
        </view>
        <view class="info-item">
          <text class="info-label">æ•…éšœæè¿°:</text>
          <text class="info-value description">{{item.description}}</text>
        </view>
        <view class="info-item">
          <text class="info-label">ä¸‹å•æ—¶é—´:</text>
          <text class="info-value">{{item.createTime || item.created_at}}</text>
        </view>
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="order-actions" catchtap="" wx:if="{{item.canCancel || item.canAccept || item.canComplete || item.canPay || item.canReview}}">
        <!-- å¾…æ¥å•çŠ¶æ€ -->
        <block wx:if="{{item.status === 'pending'}}">
          <button 
            wx:if="{{item.canCancel}}"
            class="action-btn cancel-btn"
            data-id="{{item.id}}"
            catchtap="cancelOrder"
          >
            å–æ¶ˆè®¢å•
          </button>
          <button 
            wx:if="{{item.canAccept}}"
            class="action-btn accept-btn"
            data-id="{{item.id}}"
            catchtap="acceptOrder"
          >
            æ¥å•
          </button>
        </block>

        <!-- è¿›è¡Œä¸­çŠ¶æ€ -->
        <block wx:if="{{item.status === 'in_progress'}}">
          <button 
            wx:if="{{item.canCancel}}"
            class="action-btn cancel-btn"
            data-id="{{item.id}}"
            catchtap="cancelOrder"
          >
            å–æ¶ˆè®¢å•
          </button>
          <button 
            wx:if="{{item.electrician && item.electrician.phone}}"
            class="action-btn contact-btn"
            data-phone="{{item.electrician.phone}}"
            catchtap="contactUser"
          >
            è”ç³»ç”µå·¥
          </button>
          <button 
            wx:if="{{item.canComplete}}"
            class="action-btn complete-btn"
            data-id="{{item.id}}"
            catchtap="completeOrder"
          >
            å®Œæˆè®¢å•
          </button>
          <button 
            wx:if="{{item.contactPhone}}"
            class="action-btn contact-btn"
            data-phone="{{item.contactPhone}}"
            catchtap="contactUser"
          >
            è”ç³»ç”¨æˆ·
          </button>
        </block>

        <!-- å·²å®ŒæˆçŠ¶æ€ -->
        <block wx:if="{{item.status === 'completed'}}">
          <button 
            wx:if="{{item.canPay}}"
            class="action-btn pay-btn"
            data-id="{{item.id}}"
            catchtap="goToPay"
          >
            å»æ”¯ä»˜
          </button>
          <button 
            wx:if="{{item.canReview}}"
            class="action-btn review-btn"
            data-id="{{item.id}}"
            catchtap="goToReview"
          >
            è¯„ä»·
          </button>
        </block>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{!loading && orders.length === 0}}">
      <text class="empty-icon">ğŸ“‹</text>
      <text class="empty-text">æš‚æ— è®¢å•</text>
    </view>

    <!-- åŠ è½½çŠ¶æ€ -->
    <view class="loading-state" wx:if="{{loading}}">
      <text>åŠ è½½ä¸­...</text>
    </view>

    <!-- æ²¡æœ‰æ›´å¤š -->
    <view class="no-more" wx:if="{{!hasMore && orders.length > 0}}">
      <text>æ²¡æœ‰æ›´å¤šè®¢å•äº†</text>
    </view>
  </view>
</view>